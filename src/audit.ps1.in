#Requires -RunAsAdministrator

Write-Out "Audit script version 1.1.0`n" -ForegroundColor Green

//include "functions/hardware_readiness.ps1"

<# OPTIONS #>

$rocksaltPath = "C:\Rocksalt"

<# HELPER FUNCTIONS #>

//include "functions/helper.ps1"

<# INITIAL SETUP #>

$warnings = @()

# Ensure directory exists
if (-not (Test-Path -Path $rocksaltPath)) {
  New-Item -ItemType Directory -Path $rocksaltPath | Out-Null
  Write-Out "Output directory created: $rocksaltPath"
}
else {
  Write-Out "Output directory already exists: $rocksaltPath"
}


<# AUDIT INFORMATION #>

//include "functions/audit_info.ps1"


<# BRUTE FORCE PROTECTION #>

Write-Out "`n=== Running brute force commands ===`n" -ForegroundColor DarkYellow
net accounts /lockoutthreshold:10 | Out-Null
net accounts /lockoutwindow:5 | Out-Null
net accounts /lockoutduration:30 | Out-Null


<# TEAMVIEWER #>

//include "functions/teamviewer.ps1"


<# ROCKSALT USER #>

//include "functions/rocksalt_user.ps1"


<# WINDOWS 11 COMPATIBLE #>

//include "functions/windows11_compatible.ps1"


<# AUDITER INPUT #>

//ifdef INPUT
//include "functions/audit_input.ps1"
//endif


<# BITLOCKER #>

//include "functions/bitlocker.ps1"


<# OUTPUT #>

Write-Out "`n=== Output ===`n" -ForegroundColor DarkYellow

if ($warnings.Count -gt 0 -and (Read-Y "Would you like to add warnings to notes?")) {
  if ($notes -ne "") {
    $notes += "; "
  }
  $notes += "Warnings: $($warnings -join ', ')"
}

//ifdef INPUT
//include "functions/output_table.ps1"
//else
//include "functions/output_table_noinput.ps1"
//endif

//ifdef OUTPUT
$line = ($outTable.PSObject.Properties | ForEach-Object { $_.Value }) -join "`t"

Write-Out "`nTab-separated Line:`n" -ForegroundColor DarkYellow
Write-Out $line

Write-Out "`n=== Vertical Table ===`n" -ForegroundColor DarkYellow
$outTable | Format-List
//endif


<# SAVE OUTPUT #>

//ifdef NORMAL
//include "functions/output.ps1"
//endif
//ifdef DATA_SOURCE
//include "functions/data_source.ps1"
//endif
//ifdef CUSTOM_ATTRIBUTES
//include "functions/custom_attributes.ps1"
//endif
