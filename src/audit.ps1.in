#Requires -RunAsAdministrator

//include "functions/hardware_readiness.ps1"


<# HELPER FUNCTIONS #>

//include "functions/helper.ps1"


<# INITIAL SETUP #>

Write-Out "Audit script version 1.1.0`n" -ForegroundColor Green

$global:warnings = @()

$rocksaltPath = "C:\Rocksalt"

# Ensure rocksalt directory exists
if (-not (Test-Path -Path $rocksaltPath)) {
  New-Item -ItemType Directory -Path $rocksaltPath | Out-Null
  Write-Out "Rocksalt directory created: $rocksaltPath"
}
else {
  Write-Out "Rocksalt directory already exists: $rocksaltPath"
}


<# AUDIT INFORMATION #>

//include "functions/audit_info.ps1"


<# BRUTE FORCE PROTECTION #>

Write-Out "`n=== Running brute force commands ===`n" -ForegroundColor DarkYellow
net accounts /lockoutthreshold:10 /lockoutwindow:5 /lockoutduration:30 | Out-Null


<# TEAMVIEWER #>

//include "functions/teamviewer.ps1"


<# ROCKSALT USER #>

//include "functions/rocksalt_user.ps1"


<# WINDOWS 11 COMPATIBLE #>

//include "functions/windows11_compatible.ps1"


<# AUDITER INPUT #>

//ifdef INPUT
//include "functions/audit_input.ps1"
//endif


<# BITLOCKER #>

//include "functions/bitlocker.ps1"


<# OUTPUT #>

Write-Out "`n=== Output ===`n" -ForegroundColor DarkYellow

if ($warnings.Count -gt 0 -and (Read-Y "Would you like to add warnings to notes?")) {
  $notes = if ($notes) { "$notes; " } else { "" }
  $notes += "Warnings: $($warnings -join ', ')"
}

//ifdef INPUT
//include "functions/output_table.ps1"
//else
//include "functions/output_table_noinput.ps1"
//endif

//ifdef OUTPUT
$line = ($outTable.PSObject.Properties | ForEach-Object { $_.Value }) -join "`t"

Write-Out "`nTab-separated Line:`n" -ForegroundColor DarkYellow
Write-Out $line

Write-Out "`n=== Vertical Table ===`n" -ForegroundColor DarkYellow
$outTable | Format-List
//endif


<# SAVE OUTPUT #>

//ifdef NORMAL
//include "functions/output.ps1"
//endif
//ifdef CUSTOM_ATTRIBUTES
foreach ($property in $outTable.PSObject.Properties) {
  Action1-Set-CustomAttribute "$($property.Name)" "$($property.Value)"
}
//endif
//ifdef DATA_SOURCE
$outTable
//endif
